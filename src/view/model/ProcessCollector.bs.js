// Generated by BUCKLESCRIPT VERSION 3.0.0, PLEASE EDIT WITH CARE
'use strict';

var Curry = require("bs-platform/lib/js/curry.js");
var Utils = require("../../utils/Utils.bs.js");
var Belt_Map = require("bs-platform/lib/js/belt_Map.js");
var Belt_Set = require("bs-platform/lib/js/belt_Set.js");
var Belt_List = require("bs-platform/lib/js/belt_List.js");
var PrimitiveTypes = require("../../application/PrimitiveTypes.bs.js");

var make = PrimitiveTypes.ProcessId[/* makeMap */8];

function addProposal(localUser, param, makeData, map) {
  var supporterId = param[/* supporterId */4];
  var eligibleWhenProposing = param[/* eligibleWhenProposing */3];
  var processId = param[/* processId */0];
  return Belt_Map.set(map, processId, /* record */[
              /* processId */processId,
              /* status : PendingApproval */0,
              /* canVote */PrimitiveTypes.UserId[/* neq */6](supporterId, localUser) && Belt_Set.has(eligibleWhenProposing, localUser),
              /* voters */Belt_List.mapU(Belt_Set.toList(eligibleWhenProposing), (function (userId) {
                      var match = PrimitiveTypes.UserId[/* eq */5](supporterId, userId);
                      return /* record */[
                              /* userId */userId,
                              /* voteStatus */match ? /* Endorsed */1 : /* Pending */0
                            ];
                    })),
              /* data */Curry._1(makeData, param[/* data */6])
            ]);
}

function addRejection(localUser, param, map) {
  var rejectorId = param[/* rejectorId */1];
  return Belt_Map.update(map, param[/* processId */0], (function (param) {
                return Utils.mapOption((function ($$process) {
                              return /* record */[
                                      /* processId */$$process[/* processId */0],
                                      /* status */$$process[/* status */1],
                                      /* canVote */$$process[/* canVote */2] && PrimitiveTypes.UserId[/* neq */6](rejectorId, localUser),
                                      /* voters */Belt_List.mapU($$process[/* voters */3], (function (param) {
                                              var userId = param[/* userId */0];
                                              var match = PrimitiveTypes.UserId[/* eq */5](userId, rejectorId);
                                              if (match) {
                                                return /* record */[
                                                        /* userId */userId,
                                                        /* voteStatus : Rejected */2
                                                      ];
                                              } else {
                                                return /* record */[
                                                        /* userId */userId,
                                                        /* voteStatus */param[/* voteStatus */1]
                                                      ];
                                              }
                                            })),
                                      /* data */$$process[/* data */4]
                                    ];
                            }), param);
              }));
}

function addEndorsement(localUser, param, map) {
  var supporterId = param[/* supporterId */1];
  return Belt_Map.update(map, param[/* processId */0], (function (param) {
                return Utils.mapOption((function ($$process) {
                              return /* record */[
                                      /* processId */$$process[/* processId */0],
                                      /* status */$$process[/* status */1],
                                      /* canVote */$$process[/* canVote */2] && PrimitiveTypes.UserId[/* neq */6](supporterId, localUser),
                                      /* voters */Belt_List.mapU($$process[/* voters */3], (function (param) {
                                              var userId = param[/* userId */0];
                                              var match = PrimitiveTypes.UserId[/* eq */5](userId, supporterId);
                                              if (match) {
                                                return /* record */[
                                                        /* userId */userId,
                                                        /* voteStatus : Endorsed */1
                                                      ];
                                              } else {
                                                return /* record */[
                                                        /* userId */userId,
                                                        /* voteStatus */param[/* voteStatus */1]
                                                      ];
                                              }
                                            })),
                                      /* data */$$process[/* data */4]
                                    ];
                            }), param);
              }));
}

function addAcceptance(param, map) {
  return Belt_Map.update(map, param[/* processId */0], (function (param) {
                return Utils.mapOption((function (payout) {
                              return /* record */[
                                      /* processId */payout[/* processId */0],
                                      /* status : Accepted */1,
                                      /* canVote */false,
                                      /* voters */payout[/* voters */3],
                                      /* data */payout[/* data */4]
                                    ];
                            }), param);
              }));
}

function updateData(processId, fn, map) {
  return Belt_Map.update(map, processId, (function (param) {
                return Utils.mapOption((function ($$process) {
                              return /* record */[
                                      /* processId */$$process[/* processId */0],
                                      /* status */$$process[/* status */1],
                                      /* canVote */$$process[/* canVote */2],
                                      /* voters */$$process[/* voters */3],
                                      /* data */Curry._1(fn, $$process[/* data */4])
                                    ];
                            }), param);
              }));
}

exports.make = make;
exports.addProposal = addProposal;
exports.addRejection = addRejection;
exports.addEndorsement = addEndorsement;
exports.addAcceptance = addAcceptance;
exports.updateData = updateData;
/* Utils Not a pure module */
