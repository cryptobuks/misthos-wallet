// Generated by BUCKLESCRIPT VERSION 4.0.4, PLEASE EDIT WITH CARE
'use strict';

var Belt_Map = require("bs-platform/lib/js/belt_Map.js");
var WalletTypes = require("../../application/wallet/WalletTypes.bs.js");
var PrimitiveTypes = require("../../application/PrimitiveTypes.bs.js");
var CustodianKeyChain = require("../../application/wallet/CustodianKeyChain.bs.js");

function make(localUser) {
  return /* record */[
          /* localUser */localUser,
          /* ledgerIds */WalletTypes.AccountIndex[/* makeMap */10](/* () */0),
          /* ledgerUpToDate */WalletTypes.AccountIndex[/* makeMap */10](/* () */0),
          /* nextKeyChainIdx */WalletTypes.AccountIndex[/* makeMap */10](/* () */0)
        ];
}

function ledgerId(accountIdx, param) {
  return Belt_Map.get(param[/* ledgerIds */1], accountIdx);
}

function ledgerUpToDate(accountIdx, param) {
  return Belt_Map.getWithDefault(param[/* ledgerUpToDate */2], accountIdx, false);
}

function nextKeyChainIdx(accountIdx, param) {
  return Belt_Map.getWithDefault(param[/* nextKeyChainIdx */3], accountIdx, WalletTypes.CustodianKeyChainIndex[/* first */10]);
}

function apply($$event, state) {
  switch ($$event.tag | 0) {
    case 10 : 
        if (PrimitiveTypes.UserId[/* neq */6]($$event[0][/* data */2][/* id */0], state[/* localUser */0])) {
          return /* record */[
                  /* localUser */state[/* localUser */0],
                  /* ledgerIds */state[/* ledgerIds */1],
                  /* ledgerUpToDate */WalletTypes.AccountIndex[/* makeMap */10](/* () */0),
                  /* nextKeyChainIdx */state[/* nextKeyChainIdx */3]
                ];
        } else {
          return state;
        }
    case 37 : 
        var match = $$event[0];
        var keyChain = match[/* keyChain */2];
        if (PrimitiveTypes.UserId[/* eq */5](match[/* custodianId */1], state[/* localUser */0])) {
          var accountIdx = CustodianKeyChain.accountIdx(keyChain);
          var match$1 = CustodianKeyChain.hardwareId(keyChain);
          return /* record */[
                  /* localUser */state[/* localUser */0],
                  /* ledgerIds */match$1 !== undefined ? Belt_Map.set(state[/* ledgerIds */1], accountIdx, match$1) : state[/* ledgerIds */1],
                  /* ledgerUpToDate */Belt_Map.set(state[/* ledgerUpToDate */2], accountIdx, true),
                  /* nextKeyChainIdx */Belt_Map.set(state[/* nextKeyChainIdx */3], accountIdx, WalletTypes.CustodianKeyChainIndex[/* next */2](CustodianKeyChain.keyChainIdx(keyChain)))
                ];
        } else {
          return state;
        }
    default:
      return state;
  }
}

exports.make = make;
exports.ledgerId = ledgerId;
exports.ledgerUpToDate = ledgerUpToDate;
exports.nextKeyChainIdx = nextKeyChainIdx;
exports.apply = apply;
/* WalletTypes Not a pure module */
