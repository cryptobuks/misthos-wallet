// Generated by BUCKLESCRIPT VERSION 3.0.0, PLEASE EDIT WITH CARE
'use strict';

var BTC = require("../application/wallet/BTC.bs.js");
var List = require("bs-platform/lib/js/list.js");
var $$Array = require("bs-platform/lib/js/array.js");
var Block = require("bs-platform/lib/js/block.js");
var Body3 = require("./components/Body3.bs.js");
var Curry = require("bs-platform/lib/js/curry.js");
var Utils = require("../utils/Utils.bs.js");
var React = require("react");
var Payout = require("./components/Payout.bs.js");
var Partner = require("./components/Partner.bs.js");
var ViewModel = require("./ViewModel.bs.js");
var LinkButton = require("./components/LinkButton.bs.js");
var MaterialUi = require("@jsiebern/bs-material-ui/src/MaterialUi.bs.js");
var MTypography = require("./components/MTypography.bs.js");
var ReasonReact = require("reason-react/src/ReasonReact.js");
var WalletTypes = require("../application/wallet/WalletTypes.bs.js");
var PrimitiveTypes = require("../application/PrimitiveTypes.bs.js");

var component = ReasonReact.reducerComponent("SelectedVenture");

function make(initialViewModel, session, commands, _) {
  return /* record */[
          /* debugName */component[/* debugName */0],
          /* reactClassInternal */component[/* reactClassInternal */1],
          /* handedOffState */component[/* handedOffState */2],
          /* willReceiveProps */(function () {
              return /* record */[
                      /* viewModel */initialViewModel,
                      /* selfRemoved */ViewModel.isPartner(session[/* userId */0], initialViewModel) === false,
                      /* balance */ViewModel.balance(initialViewModel)
                    ];
            }),
          /* didMount */component[/* didMount */4],
          /* didUpdate */component[/* didUpdate */5],
          /* willUnmount */component[/* willUnmount */6],
          /* willUpdate */component[/* willUpdate */7],
          /* shouldUpdate */component[/* shouldUpdate */8],
          /* render */(function (param) {
              var send = param[/* send */3];
              var state = param[/* state */1];
              var partners = $$Array.of_list(List.map((function (partner) {
                          return ReasonReact.element(/* Some */[PrimitiveTypes.UserId[/* toString */0](partner[/* userId */0])], /* None */0, Partner.make(partner, /* array */[]));
                        }), ViewModel.partners(state[/* viewModel */0])));
              var prospects = $$Array.of_list(List.map((function (prospect) {
                          return React.createElement("li", {
                                      key: PrimitiveTypes.UserId[/* toString */0](prospect[/* userId */1])
                                    }, Utils.text("'" + (PrimitiveTypes.UserId[/* toString */0](prospect[/* userId */1]) + ("' endorsed by: " + List.fold_left((function (state, partnerId) {
                                                    return state + (partnerId + " ");
                                                  }), "", List.map(PrimitiveTypes.UserId[/* toString */0], prospect[/* endorsedBy */2]))))), List.mem(session[/* userId */0], prospect[/* endorsedBy */2]) === false ? React.createElement("button", {
                                            onClick: (function () {
                                                return Curry._1(send, /* EndorsePartner */Block.__(0, [prospect[/* processId */0]]));
                                              })
                                          }, Utils.text("Endorse Partner")) : null);
                        }), ViewModel.prospects(state[/* viewModel */0])));
              var removalProspects = $$Array.of_list(List.map((function (prospect) {
                          return React.createElement("li", {
                                      key: PrimitiveTypes.UserId[/* toString */0](prospect[/* userId */1])
                                    }, Utils.text("'" + (PrimitiveTypes.UserId[/* toString */0](prospect[/* userId */1]) + ("' endorsed by: " + List.fold_left((function (state, partnerId) {
                                                    return state + (partnerId + " ");
                                                  }), "", List.map(PrimitiveTypes.UserId[/* toString */0], prospect[/* endorsedBy */2]))))), List.mem(session[/* userId */0], prospect[/* endorsedBy */2]) === false ? React.createElement("button", {
                                            onClick: (function () {
                                                return Curry._1(send, /* EndorsePartnerRemoval */Block.__(1, [prospect[/* processId */0]]));
                                              })
                                          }, Utils.text("Endorse Removal")) : null);
                        }), ViewModel.removalProspects(state[/* viewModel */0])));
              var addresses = $$Array.of_list(List.map((function (address) {
                          return React.createElement("li", {
                                      key: address
                                    }, Utils.text(address));
                        }), ViewModel.incomeAddresses(state[/* viewModel */0])));
              var payouts = $$Array.of_list(List.map((function (payout) {
                          var match = payout[/* status */4];
                          var tmp;
                          tmp = typeof match === "number" ? "pending" : (
                              match.tag ? "failed (error: '" + (match[0] + "')") : "completed (txId: " + (match[0] + ")")
                            );
                          var match$1 = payout[/* status */4];
                          var match$2 = List.mem(session[/* userId */0], payout[/* endorsedBy */2]);
                          var match$3 = payout[/* status */4];
                          var match$4 = List.mem(session[/* userId */0], payout[/* rejectedBy */3]);
                          var match$5 = List.mem(session[/* userId */0], payout[/* endorsedBy */2]);
                          return React.createElement("li", {
                                      key: PrimitiveTypes.ProcessId[/* toString */0](payout[/* processId */0])
                                    }, Utils.text("'" + (PrimitiveTypes.ProcessId[/* toString */0](payout[/* processId */0]) + ("' status: " + (tmp + (" endorsed by: " + (List.fold_left((function (state, partnerId) {
                                                          return state + (partnerId + " ");
                                                        }), "", List.map(PrimitiveTypes.UserId[/* toString */0], payout[/* endorsedBy */2])) + (" rejected by: " + List.fold_left((function (state, partnerId) {
                                                            return state + (partnerId + " ");
                                                          }), "", List.map(PrimitiveTypes.UserId[/* toString */0], payout[/* rejectedBy */3]))))))))), typeof match$1 === "number" && !match$2 ? React.createElement("button", {
                                            onClick: (function () {
                                                return Curry._1(send, /* EndorsePayout */Block.__(4, [payout[/* processId */0]]));
                                              })
                                          }, Utils.text("Endorse Payout")) : null, typeof match$3 === "number" && !(match$4 || match$5) ? React.createElement("button", {
                                            onClick: (function () {
                                                return Curry._1(send, /* RejectPayout */Block.__(3, [payout[/* processId */0]]));
                                              })
                                          }, Utils.text("Reject Payout")) : null);
                        }), ViewModel.payouts(state[/* viewModel */0])));
              var match = state[/* selfRemoved */1];
              return ReasonReact.element(/* None */0, /* None */0, Body3.make(/* Some */[/* :: */[
                                "Partners",
                                /* :: */[
                                  "Transactions",
                                  /* [] */0
                                ]
                              ]], React.createElement("div", undefined, ReasonReact.element(/* None */0, /* None */0, MTypography.make(/* Title */594052472, /* None */0, /* array */[Utils.text(ViewModel.ventureName(state[/* viewModel */0]))])), ReasonReact.element(/* None */0, /* None */0, MTypography.make(/* Display2 */-11760688, /* None */0, /* array */[
                                          React.createElement("b", {
                                                key: "currentSpendable"
                                              }, Utils.text(BTC.format(state[/* balance */2][/* currentSpendable */0]))),
                                          Utils.text("BTC")
                                        ])), ReasonReact.element(/* None */0, /* None */0, MTypography.make(/* Subheading */148169314, /* None */0, /* array */[
                                          React.createElement("b", {
                                                key: "reserved"
                                              }, Utils.text(BTC.format(state[/* balance */2][/* reserved */1]))),
                                          Utils.text(" BTC IN RESERVE")
                                        ]))), React.createElement("div", undefined, match ? React.createElement("b", undefined, Utils.text("YOU HAVE BEEN REMOVED FROM THIS VENTURE; VENTURE IS IN READ ONLY")) : null, ReasonReact.element(/* None */0, /* None */0, MaterialUi.List[/* make */1](/* None */0, /* None */0, /* None */0, /* Some */[true], /* None */0, /* None */0, /* array */[partners])), React.createElement("h4", undefined, Utils.text("Prospects:")), React.createElement("ul", undefined, prospects), React.createElement("h4", undefined, Utils.text("To be removed:")), React.createElement("ul", undefined, removalProspects), ReasonReact.element(/* None */0, /* None */0, LinkButton.make(/* Venture */Block.__(0, [
                                            ViewModel.ventureId(state[/* viewModel */0]),
                                            /* ManagePartners */1
                                          ]), /* Some */[true], /* array */[Utils.text("Add or Remove Partners")]))), React.createElement("div", undefined, React.createElement("h3", undefined, Utils.text("Wallet:")), React.createElement("h4", undefined, Utils.text("Income Addresses:")), React.createElement("ul", undefined, addresses), React.createElement("button", {
                                      onClick: (function () {
                                          return Curry._1(send, /* GetIncomeAddress */0);
                                        })
                                    }, Utils.text("Get New Income Address")), ReasonReact.element(/* None */0, /* None */0, Payout.make((function (destinations) {
                                            return Curry._1(send, /* ProposePayout */Block.__(2, [destinations]));
                                          }), /* array */[])), React.createElement("h4", undefined, Utils.text("Payouts:")), React.createElement("ul", undefined, payouts)), /* array */[]));
            }),
          /* initialState */(function () {
              return /* record */[
                      /* viewModel */initialViewModel,
                      /* selfRemoved */ViewModel.isPartner(session[/* userId */0], initialViewModel) === false,
                      /* balance */ViewModel.balance(initialViewModel)
                    ];
            }),
          /* retainedProps */component[/* retainedProps */11],
          /* reducer */(function (action, state) {
              var match = state[/* selfRemoved */1];
              if (match) {
                return /* NoUpdate */0;
              } else if (typeof action === "number") {
                Curry._1(commands[/* exposeIncomeAddress */9], WalletTypes.AccountIndex[/* default */9]);
                return /* NoUpdate */0;
              } else {
                switch (action.tag | 0) {
                  case 0 : 
                      Curry._1(commands[/* endorsePartner */1], action[0]);
                      return /* NoUpdate */0;
                  case 1 : 
                      Curry._1(commands[/* endorsePartnerRemoval */5], action[0]);
                      return /* NoUpdate */0;
                  case 2 : 
                      Curry._3(commands[/* proposePayout */6], WalletTypes.AccountIndex[/* default */9], action[0], BTC.fromSatoshis(/* int64 */[
                                /* hi */0,
                                /* lo */5
                              ]));
                      return /* NoUpdate */0;
                  case 3 : 
                      Curry._1(commands[/* rejectPayout */8], action[0]);
                      return /* NoUpdate */0;
                  case 4 : 
                      Curry._1(commands[/* endorsePayout */7], action[0]);
                      return /* NoUpdate */0;
                  
                }
              }
            }),
          /* subscriptions */component[/* subscriptions */13],
          /* jsElementWrapped */component[/* jsElementWrapped */14]
        ];
}

var text = Utils.text;

exports.text = text;
exports.component = component;
exports.make = make;
/* component Not a pure module */
